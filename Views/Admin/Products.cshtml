@model ElectronicsStore.ViewModels.AdminProductListViewModel

@{
    ViewData["Title"] = "Quản lý sản phẩm";
    Layout = "_AdminLayout";
}

<!-- Filters -->
<div class="table-container mb-4">
    <form method="get" class="row g-3">
        <div class="col-md-3">
            <label class="form-label">Tìm kiếm</label>
            <input type="text" name="search" value="@Model.SearchTerm" class="form-control" placeholder="Tên, SKU, Part Number...">
        </div>
        <div class="col-md-2">
            <label class="form-label">Danh mục</label>
            <select name="categoryId" class="form-select">
                <option value="">Tất cả</option>
                @foreach (var category in Model.Categories)
                {
                    <option value="@category.Id" selected="@(Model.CategoryId == category.Id)">@category.Name</option>
                }
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Thương hiệu</label>
            <select name="brandId" class="form-select">
                <option value="">Tất cả</option>
                @foreach (var brand in Model.Brands)
                {
                    <option value="@brand.Id" selected="@(Model.BrandId == brand.Id)">@brand.Name</option>
                }
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Trạng thái</label>
            <select name="isActive" class="form-select">
                <option value="">Tất cả</option>
                <option value="true" selected="@(Model.IsActive == true)">Hoạt động</option>
                <option value="false" selected="@(Model.IsActive == false)">Tạm dừng</option>
            </select>
        </div>
        <div class="col-md-2">
            <label class="form-label">Sắp xếp</label>
            <select name="sortBy" class="form-select">
                <option value="name" selected="@(Model.SortBy == "name")">Tên A-Z</option>
                <option value="price" selected="@(Model.SortBy == "price")">Giá thấp-cao</option>
                <option value="stock" selected="@(Model.SortBy == "stock")">Tồn kho</option>
                <option value="sold" selected="@(Model.SortBy == "sold")">Bán chạy</option>
                <option value="created" selected="@(Model.SortBy == "created")">Mới nhất</option>
            </select>
        </div>
        <div class="col-md-1">
            <label class="form-label">&nbsp;</label>
            <button type="submit" class="btn btn-primary d-block">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </form>
</div>

<!-- Actions -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h5 class="mb-0">
            <i class="fas fa-microchip me-2"></i>
            Danh sách sản phẩm (@Model.TotalItems.ToString("N0"))
        </h5>
    </div>
    <div>
        <a href="#" class="btn btn-success">
            <i class="fas fa-plus me-2"></i>Thêm sản phẩm
        </a>
        <a href="#" class="btn btn-outline-primary">
            <i class="fas fa-download me-2"></i>Xuất Excel
        </a>
    </div>
</div>

<!-- Products Table -->
<div class="table-container">
    @if (Model.Products.Any())
    {
        <div class="table-responsive">
            <table class="table table-hover">
                <thead class="table-light">
                    <tr>
                        <th style="width: 60px;">Hình</th>
                        <th>Sản phẩm</th>
                        <th>Danh mục</th>
                        <th>Thương hiệu</th>
                        <th>Giá</th>
                        <th>Tồn kho</th>
                        <th>Đã bán</th>
                        <th>Trạng thái</th>
                        <th style="width: 120px;">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var product in Model.Products)
                    {
                        <tr>
                            <td>
                                <img src="@product.MainImageUrl" alt="@product.Name" 
                                     class="rounded" style="width: 50px; height: 50px; object-fit: cover;">
                            </td>
                            <td>
                                <div>
                                    <strong>@product.Name</strong>
                                    <br>
                                    <small class="text-muted">
                                        SKU: @product.SKU
                                        @if (!string.IsNullOrEmpty(product.PartNumber))
                                        {
                                            <span> | PN: @product.PartNumber</span>
                                        }
                                    </small>
                                </div>
                            </td>
                            <td>@product.Category.Name</td>
                            <td>@product.Brand.Name</td>
                            <td>
                                <strong>@product.Price.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))</strong>
                                @if (product.DiscountPrice.HasValue && product.DiscountPrice < product.Price)
                                {
                                    <br>
                                    <small class="text-success">
                                        Giảm: @product.DiscountPrice.Value.ToString("C0", new System.Globalization.CultureInfo("vi-VN"))
                                    </small>
                                }
                            </td>
                            <td>
                                <span class="badge bg-@(product.StockQuantity <= product.MinStockLevel ? "danger" : product.StockQuantity <= product.MinStockLevel * 2 ? "warning" : "success")">
                                    @product.StockQuantity
                                </span>
                                @if (product.StockQuantity <= product.MinStockLevel)
                                {
                                    <br><small class="text-danger">Sắp hết hàng</small>
                                }
                            </td>
                            <td>
                                <strong>@product.SoldCount</strong>
                                <br>
                                <small class="text-muted">@product.ViewCount lượt xem</small>
                            </td>
                            <td>
                                <span class="badge bg-@(product.IsActive ? "success" : "secondary")">
                                    @(product.IsActive ? "Hoạt động" : "Tạm dừng")
                                </span>
                                @if (product.IsFeatured)
                                {
                                    <br><span class="badge bg-warning">Nổi bật</span>
                                }
                                @if (product.IsNewProduct)
                                {
                                    <br><span class="badge bg-info">Mới</span>
                                }
                            </td>
                            <td>
                                <div class="btn-group-vertical btn-group-sm">
                                    <a href="#" class="btn btn-outline-primary btn-sm" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="#" class="btn btn-outline-warning btn-sm" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button type="button" class="btn btn-outline-danger btn-sm" title="Xóa" 
                                            onclick="confirmDelete(@product.Id, '@product.Name')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        @if (Model.TotalPages > 1)
        {
            <nav class="mt-4">
                <ul class="pagination justify-content-center">
                    @if (Model.CurrentPage > 1)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?page=@(Model.CurrentPage - 1)&search=@Model.SearchTerm&categoryId=@Model.CategoryId&brandId=@Model.BrandId&isActive=@Model.IsActive&sortBy=@Model.SortBy">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                    }

                    @for (int i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min(Model.TotalPages, Model.CurrentPage + 2); i++)
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a class="page-link" href="?page=@i&search=@Model.SearchTerm&categoryId=@Model.CategoryId&brandId=@Model.BrandId&isActive=@Model.IsActive&sortBy=@Model.SortBy">@i</a>
                        </li>
                    }

                    @if (Model.CurrentPage < Model.TotalPages)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?page=@(Model.CurrentPage + 1)&search=@Model.SearchTerm&categoryId=@Model.CategoryId&brandId=@Model.BrandId&isActive=@Model.IsActive&sortBy=@Model.SortBy">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    }
                </ul>
            </nav>
        }
    }
    else
    {
        <div class="text-center py-5">
            <i class="fas fa-box fa-4x text-muted mb-3"></i>
            <h5 class="text-muted">Không tìm thấy sản phẩm nào</h5>
            <p class="text-muted">Thử thay đổi bộ lọc hoặc thêm sản phẩm mới</p>
            <a href="#" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Thêm sản phẩm đầu tiên
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        function confirmDelete(productId, productName) {
            if (confirm(`Bạn có chắc chắn muốn xóa sản phẩm "${productName}"?`)) {
                // TODO: Implement delete functionality
                console.log('Delete product:', productId);
            }
        }
    </script>
}
